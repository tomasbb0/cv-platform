<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CV Editor Platform</title>
    <style>
      :root {
        --bg: #0f0f0f;
        --panel: #1a1a1a;
        --border: #2a2a2a;
        --text: #e0e0e0;
        --muted: #888;
        --accent: #3b82f6;
        --accent-hover: #2563eb;
        --danger: #ef4444;
        --success: #22c55e;
        --paper-w: 210mm;
        --paper-h: 297mm;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family:
          "SF Pro Display",
          -apple-system,
          BlinkMacSystemFont,
          "Inter",
          sans-serif;
        background: var(--bg);
        color: var(--text);
        height: 100vh;
        overflow: hidden;
      }

      /* â•â•â• LAYOUT â•â•â• */
      .app {
        display: flex;
        height: 100vh;
      }
      .editor-panel {
        width: 45%;
        min-width: 400px;
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      .preview-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        overflow-y: auto;
        background: #252525;
      }

      /* â•â•â• TOOLBAR â•â•â• */
      .toolbar {
        padding: 12px 16px;
        background: var(--panel);
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 10px;
        flex-shrink: 0;
      }
      .toolbar h1 {
        font-size: 14px;
        font-weight: 700;
        letter-spacing: 0.5px;
        flex: 1;
      }
      .toolbar h1 span {
        color: var(--accent);
      }
      .btn {
        padding: 6px 14px;
        border: none;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.15s;
        font-family: inherit;
      }
      .btn-primary {
        background: var(--accent);
        color: #fff;
      }
      .btn-primary:hover {
        background: var(--accent-hover);
      }
      .btn-secondary {
        background: #333;
        color: var(--text);
      }
      .btn-secondary:hover {
        background: #444;
      }
      .btn-danger {
        background: var(--danger);
        color: #fff;
      }
      .btn-danger:hover {
        background: #dc2626;
      }
      .btn-sm {
        padding: 4px 8px;
        font-size: 10px;
      }

      /* â•â•â• STATUS BAR â•â•â• */
      .status-bar {
        padding: 6px 16px;
        background: #111;
        border-top: 1px solid var(--border);
        font-size: 10px;
        color: var(--muted);
        display: flex;
        justify-content: space-between;
        flex-shrink: 0;
      }
      .fit-indicator {
        font-weight: 700;
      }
      .fit-ok {
        color: var(--success);
      }
      .fit-warn {
        color: #f59e0b;
      }
      .fit-over {
        color: var(--danger);
      }

      /* â•â•â• EDITOR SECTIONS â•â•â• */
      .editor-content {
        flex: 1;
        overflow-y: auto;
        padding: 12px;
      }
      .section-block {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 8px;
        margin-bottom: 8px;
        overflow: hidden;
      }
      .section-header {
        padding: 8px 12px;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        user-select: none;
        background: #222;
        border-bottom: 1px solid var(--border);
      }
      .section-header:hover {
        background: #282828;
      }
      .section-title {
        flex: 1;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .section-actions {
        display: flex;
        gap: 4px;
      }
      .section-body {
        padding: 8px 12px;
      }
      .section-body.collapsed {
        display: none;
      }
      .chevron {
        transition: transform 0.2s;
        font-size: 10px;
        color: var(--muted);
      }
      .chevron.open {
        transform: rotate(90deg);
      }

      /* â•â•â• JOB BLOCKS â•â•â• */
      .job-block {
        background: #1e1e1e;
        border: 1px solid var(--border);
        border-radius: 6px;
        margin-bottom: 6px;
        padding: 8px 10px;
      }
      .job-header {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 6px;
      }
      .job-header input {
        flex: 1;
        background: transparent;
        border: 1px solid transparent;
        color: var(--text);
        font-size: 11px;
        padding: 4px 6px;
        border-radius: 4px;
        font-family: inherit;
      }
      .job-header input:focus {
        border-color: var(--accent);
        outline: none;
        background: #111;
      }
      .job-header input.company {
        font-weight: 700;
      }
      .job-header input.role {
        font-style: italic;
        color: var(--muted);
      }

      /* â•â•â• BULLET ITEMS â•â•â• */
      .bullet-list {
        list-style: none;
      }
      .bullet-item {
        display: flex;
        align-items: flex-start;
        gap: 6px;
        padding: 3px 0;
        border-radius: 4px;
        position: relative;
      }
      .bullet-item:hover {
        background: rgba(255, 255, 255, 0.03);
      }
      .bullet-drag {
        cursor: grab;
        color: var(--muted);
        font-size: 10px;
        padding: 4px 2px;
        flex-shrink: 0;
        user-select: none;
      }
      .bullet-drag:active {
        cursor: grabbing;
      }
      .bullet-text {
        flex: 1;
        background: transparent;
        border: 1px solid transparent;
        color: var(--text);
        font-size: 11px;
        padding: 3px 5px;
        border-radius: 4px;
        font-family: inherit;
        resize: vertical;
        min-height: 22px;
        line-height: 1.4;
      }
      .bullet-text:focus {
        border-color: var(--accent);
        outline: none;
        background: #111;
      }
      .bullet-actions {
        display: flex;
        gap: 2px;
        opacity: 0;
        transition: opacity 0.15s;
        flex-shrink: 0;
      }
      .bullet-item:hover .bullet-actions {
        opacity: 1;
      }
      .icon-btn {
        background: none;
        border: none;
        color: var(--muted);
        cursor: pointer;
        font-size: 12px;
        padding: 2px 4px;
        border-radius: 3px;
        transition: all 0.1s;
      }
      .icon-btn:hover {
        color: var(--text);
        background: #333;
      }
      .icon-btn.delete:hover {
        color: var(--danger);
      }
      .icon-btn.eye {
        opacity: 0.7;
      }
      .icon-btn.eye.hidden-item {
        opacity: 0.3;
      }
      .item-hidden {
        opacity: 0.35;
        text-decoration: line-through;
      }
      .item-hidden input,
      .item-hidden textarea {
        text-decoration: line-through;
        color: var(--muted) !important;
      }
      .section-block.item-hidden > .section-header {
        opacity: 0.4;
      }
      .section-block.item-hidden > .section-header .section-title {
        text-decoration: line-through;
      }
      .job-block.item-hidden {
        opacity: 0.35;
        border-style: dashed;
      }

      /* â•â•â• SIMPLE FIELDS â•â•â• */
      .field-row {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 4px;
      }
      .field-label {
        font-size: 10px;
        color: var(--muted);
        font-weight: 600;
        min-width: 60px;
        text-transform: uppercase;
        letter-spacing: 0.3px;
      }
      .field-input {
        flex: 1;
        background: transparent;
        border: 1px solid transparent;
        color: var(--text);
        font-size: 11px;
        padding: 4px 6px;
        border-radius: 4px;
        font-family: inherit;
      }
      .field-input:focus {
        border-color: var(--accent);
        outline: none;
        background: #111;
      }
      textarea.field-input {
        resize: vertical;
        min-height: 40px;
        line-height: 1.4;
        width: 100%;
        display: block;
      }

      /* â•â•â• LEADERSHIP ITEMS â•â•â• */
      .leadership-item {
        display: flex;
        align-items: flex-start;
        gap: 6px;
        margin-bottom: 4px;
      }
      .leadership-item input {
        background: transparent;
        border: 1px solid transparent;
        color: var(--text);
        font-size: 11px;
        padding: 3px 5px;
        border-radius: 4px;
        font-family: inherit;
      }
      .leadership-item input:focus {
        border-color: var(--accent);
        outline: none;
        background: #111;
      }
      .leadership-item .name {
        width: 160px;
        font-weight: 700;
      }
      .leadership-item .desc {
        flex: 1;
      }

      /* â•â•â• SKILLS â•â•â• */
      .skill-row {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 4px;
      }
      .skill-row input.skill-label {
        width: 120px;
        background: transparent;
        border: 1px solid transparent;
        color: var(--text);
        font-size: 11px;
        padding: 3px 5px;
        border-radius: 4px;
        font-family: inherit;
        font-weight: 700;
      }
      .skill-row input.skill-value {
        flex: 1;
        background: transparent;
        border: 1px solid transparent;
        color: var(--text);
        font-size: 11px;
        padding: 3px 5px;
        border-radius: 4px;
        font-family: inherit;
      }
      .skill-row input:focus {
        border-color: var(--accent);
        outline: none;
        background: #111;
      }

      /* â•â•â• PREVIEW / PAPER â•â•â• */
      .preview-toolbar {
        padding: 8px 16px;
        display: flex;
        gap: 10px;
        align-items: center;
        width: 100%;
        max-width: 820px;
        margin-bottom: 10px;
      }
      .preview-toolbar .zoom-label {
        font-size: 11px;
        color: var(--muted);
      }
      .zoom-slider {
        width: 100px;
      }

      .paper-wrapper {
        position: relative;
        flex-shrink: 0;
      }
      .paper {
        width: 210mm;
        height: 297mm;
        background: #fff;
        color: #000;
        padding: 10mm 14mm;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 9pt;
        line-height: 1.35;
        overflow: hidden;
        transform-origin: top center;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        position: relative;
      }
      .paper .cv-name {
        text-align: center;
        font-size: 15pt;
        font-weight: 700;
        margin-bottom: 2px;
      }
      .paper .cv-contact {
        text-align: center;
        font-size: 7.5pt;
        color: #555;
        margin-bottom: 6px;
      }
      .paper .cv-section-title {
        font-size: 9.5pt;
        font-weight: 700;
        border-bottom: 1px solid #000;
        padding-bottom: 1px;
        margin-top: 5px;
        margin-bottom: 3px;
        text-transform: uppercase;
      }
      .paper .cv-summary {
        font-size: 7.5pt;
        margin-bottom: 4px;
        line-height: 1.4;
      }
      .paper .cv-company {
        font-size: 8.5pt;
        font-weight: 700;
        margin-top: 3px;
      }
      .paper .cv-role {
        font-size: 8pt;
        font-style: italic;
        color: #333;
        margin-bottom: 1px;
      }
      .paper .cv-bullet {
        font-size: 7.5pt;
        padding-left: 10px;
        position: relative;
        margin-bottom: 0.5px;
        line-height: 1.35;
      }
      .paper .cv-bullet::before {
        content: "-";
        position: absolute;
        left: 2px;
      }
      .paper .cv-leadership {
        font-size: 7.5pt;
        margin-bottom: 1px;
        line-height: 1.35;
      }
      .paper .cv-leadership strong {
        font-weight: 700;
      }
      .paper .cv-skill {
        font-size: 7.5pt;
        margin-bottom: 1px;
        line-height: 1.35;
      }
      .paper .cv-skill strong {
        font-weight: 700;
      }
      .paper .cv-edu-detail {
        font-size: 7.5pt;
        padding-left: 10px;
        position: relative;
        margin-bottom: 0.5px;
        line-height: 1.35;
      }
      .paper .cv-edu-detail::before {
        content: "-";
        position: absolute;
        left: 2px;
      }

      /* Page overflow indicator */
      .overflow-line {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--danger);
        z-index: 10;
        display: none;
      }

      /* â•â•â• ADD BUTTONS â•â•â• */
      .add-row {
        display: flex;
        justify-content: center;
        padding: 4px 0;
      }
      .add-btn {
        background: none;
        border: 1px dashed var(--border);
        color: var(--muted);
        font-size: 11px;
        padding: 4px 12px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.15s;
        font-family: inherit;
      }
      .add-btn:hover {
        border-color: var(--accent);
        color: var(--accent);
        background: rgba(59, 130, 246, 0.05);
      }

      /* â•â•â• DRAG AND DROP â•â•â• */
      .dragging {
        opacity: 0.4;
      }
      .drag-over {
        border-top: 2px solid var(--accent) !important;
      }

      /* â•â•â• PRINT â•â•â• */
      @page {
        size: A4;
        margin: 0;
      }
      @media print {
        * {
          -webkit-print-color-adjust: exact !important;
          print-color-adjust: exact !important;
        }
        html,
        body {
          margin: 0 !important;
          padding: 0 !important;
          background: #fff !important;
          width: 210mm !important;
          height: 297mm !important;
          overflow: hidden !important;
        }
        .app {
          display: block !important;
          background: #fff !important;
        }
        .editor-panel,
        .preview-toolbar,
        .status-bar,
        .toolbar,
        .overflow-line {
          display: none !important;
        }
        .preview-panel {
          padding: 0 !important;
          background: #fff !important;
          overflow: visible !important;
          display: block !important;
          width: 210mm !important;
          height: 297mm !important;
        }
        .paper-wrapper {
          position: static !important;
          width: 210mm !important;
          height: 297mm !important;
        }
        .paper {
          box-shadow: none !important;
          transform: none !important;
          margin: 0 !important;
          width: 210mm !important;
          height: 297mm !important;
          overflow: hidden !important;
          position: static !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <!-- â•â•â• LEFT: EDITOR â•â•â• -->
      <div class="editor-panel">
        <div class="toolbar">
          <h1><span>CV</span> EDITOR</h1>
          <select
            id="profile-select"
            onchange="loadProfile(this.value)"
            style="
              background: #333;
              color: #e0e0e0;
              border: 1px solid #444;
              border-radius: 4px;
              padding: 3px 6px;
              font-size: 10px;
              font-family: inherit;
              max-width: 130px;
            "
          ></select>
          <button class="btn btn-primary btn-sm" onclick="saveCurrentProfile()" title="Save current profile (âŒ˜S)">
            ğŸ’¾
          </button>
          <button class="btn btn-secondary btn-sm" onclick="saveAsProfile()" title="Save as new tag">
            Save Asâ€¦
          </button>
          <button class="btn btn-secondary btn-sm" onclick="deleteProfile()" title="Delete selected profile">
            ğŸ—‘
          </button>
          <span id="profile-indicator" style="font-size:10px;color:#3b82f6;font-weight:600;max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"></span>
          <button class="btn btn-primary btn-sm" onclick="exportPDF()">
            ğŸ“„ PDF
          </button>
          <button class="btn btn-secondary btn-sm" onclick="exportProfiles()" title="Export all profiles as JSON">
            â¬‡ Backup
          </button>
          <button class="btn btn-secondary btn-sm" onclick="importProfiles()" title="Import profiles from JSON">
            â¬† Restore
          </button>
          <button class="btn btn-secondary btn-sm" onclick="addSection()">
            +
          </button>
          <button class="btn btn-secondary btn-sm" onclick="resetToDefault()">
            Reset
          </button>
        </div>
        <div class="editor-content" id="editor"></div>
        <div class="status-bar">
          <span id="fit-status" class="fit-indicator fit-ok"
            >âœ“ Fits on 1 page</span
          >
          <span id="scale-info">Scale: 100%</span>
        </div>
      </div>

      <!-- â•â•â• RIGHT: PREVIEW â•â•â• -->
      <div class="preview-panel">
        <div class="preview-toolbar">
          <span class="zoom-label">Zoom:</span>
          <input
            type="range"
            class="zoom-slider"
            min="20"
            max="200"
            value="100"
            oninput="setZoom(this.value)"
          />
          <span class="zoom-label" id="zoom-val">65%</span>
        </div>
        <div class="paper-wrapper">
          <div class="paper" id="paper">
            <!-- Rendered CV goes here -->
          </div>
          <div class="overflow-line" id="overflow-line"></div>
        </div>
      </div>
    </div>

    <script>
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          // CV DATA MODEL
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          const DEFAULT_CV = {
            name: "TomÃ¡s Maria Burnay Batalha",
            contact:
              "Lisbon, Portugal (Open to Relocation to Dublin) | (+351) 936 124 118 | tomas.b.batalha@gmail.com | linkedin.com/in/tomasmbatalha",
            sections: [
              {
                id: "summary",
                type: "summary",
                title: "PROFESSIONAL SUMMARY",
                content:
                  "Former Google intern and startup Co-Founder with full-cycle new business sales experience. Built a â‚¬147K B2B pipeline from zero through outbound prospecting, cold outreach, and enterprise deal closing. Managed a 2,311-account territory at Amazon, outperforming full-time colleagues. Seeking to bring builder mentality and commercial execution to Google's New Business Sales team.",
              },
              {
                id: "experience",
                type: "jobs",
                title: "WORK EXPERIENCE",
                jobs: [
                  {
                    company: "Pairwire | New York, USA (Remote)",
                    role: "Co-Founder and Head of Sales | February 2024 â€“ December 2025",
                    bullets: [
                      "Built â‚¬147K pipeline of contracted enterprise pilots from zero in 11 months pre-funding through outbound prospecting, cold calling, consulting, and relationship management",
                      "Closed 23 enterprise engagements including Fortune 500 and Big 4 firms across 6-9 month full-cycle sales processes",
                      "Designed an AI-powered outbound engine processing 7,000+ leads, automating 80% of prospecting via custom tech stack (Python, Expand.io, AI-enhanced workflows)",
                      "Led end-to-end deal management from first touch to contract close, managing entire funnel with no sales team or brand recognition",
                      "Created partnership and investor pitch materials; led negotiations with Google, Web Summit, and enterprise decision-makers",
                    ],
                  },
                  {
                    company: "Google | Lisbon, Portugal",
                    role: "Business Analyst Intern (Large Customer Sales) | May 2024 â€“ August 2024",
                    bullets: [
                      'Led the "Future Trends" segment at Google\'s flagship partner event, presenting personally researched insights on Peak Season activation and media readiness to 237+ senior advertising clients',
                      "Designed and automated three globally scalable dashboards using Apps Script and GMP tools to analyze ROAS vs. profit and CPA vs. conversions, projecting $1.41M in annual savings for media spend decisions",
                      "Built a reporting platform for Partner Managers using Looker Studio, Analytics 360, and Apps Script, delivering an estimated â‚¬315K in annual efficiency gains",
                    ],
                  },
                  {
                    company: "Amazon | Madrid, Spain",
                    role: "Business Development Intern (Amazon Business) | May 2022 â€“ November 2022",
                    bullets: [
                      "Led the B2B retail expansion into Portugal, managing a portfolio of 2,311 companies through prospecting, outreach, and account activation",
                      "Outperformed KPI benchmarks by 21x in company account configurations during the Portugal B2B rollout",
                      "Raised territory share from 56% below to 25% above team average, outperforming full-time colleagues in the region",
                      "Compiled a 19-page strategic report on B2B eCommerce based on 8 company territories and 54 targeted client interviews",
                    ],
                  },
                  {
                    company: "EY | Lisbon, Portugal",
                    role: "Assurance Associate (Financial Services) | February 2022 â€“ April 2022",
                    bullets: [
                      "Audited asset portfolios worth â‚¬41.3 billion across 3 insurance firms, developing rigorous data verification and attention to detail",
                    ],
                  },
                ],
              },
              {
                id: "education",
                type: "education",
                title: "EDUCATION",
                schools: [
                  {
                    institution:
                      "Rotterdam School of Management | Rotterdam, Netherlands",
                    degree: "MSc in Strategic Management | GPA: 8/10",
                    details: [
                      "Relevant Courses: Applied Machine Learning to Strategy (9.3/10), Python Fundamentals (8.3/10)",
                    ],
                  },
                  {
                    institution: "National University of Singapore | Singapore",
                    degree:
                      "MSc Curriculum Term | MBA-aligned coursework in Strategy and Innovation",
                    details: [
                      "Built a commercial and financial plan for a NUS PhD venture: 70% energy savings, 45% unit margins, 278% ROI in a $1.5B market",
                    ],
                  },
                  {
                    institution:
                      "Nova School of Business and Economics | Lisbon, Portugal",
                    degree: "BSc in Management | GPA: 16/20",
                    details: [
                      "Statistics (20/20), Procurement Management (19/20), Economics of the European Union (19/20)",
                    ],
                  },
                ],
              },
              {
                id: "leadership",
                type: "leadership",
                title: "LEADERSHIP & ACTIVITIES",
                items: [
                  {
                    name: "Nova Thirst Project",
                    desc: "Founder & President: Led 23 volunteers, raised â‚¬2,539 for water access, organized 4 events including one with 35 NGOs (2020-2021)",
                  },
                  {
                    name: "Nova Tech Club",
                    desc: "Digital Transformation Consultant: Designed a job platform prototype and organized corporate events and workshops (2020-2021)",
                  },
                  {
                    name: "Nova Social Consulting (WWF)",
                    desc: "Pro Bono Consultant: Assessed organizational structure, identified 155 improvement areas, delivered 6 presentations to senior management (2020-2021)",
                  },
                ],
              },
              {
                id: "skills",
                type: "skills",
                title: "SKILLS",
                skills: [
                  {
                    label: "Sales & Marketing:",
                    value:
                      "Google Ads, YouTube Ads, Google Display Network, CRM (Salesforce), LinkedIn Sales Navigator, Apollo, Full-Cycle Sales, Pipeline Management, Cold Outreach, Consultative Selling",
                  },
                  {
                    label: "Technical:",
                    value:
                      "Python, Apps Script, Visual Basic for Applications (VBA), SQL, Looker Studio, Power BI, DAX",
                  },
                  {
                    label: "Certifications:",
                    value:
                      "Google Ads Certified, Bloomberg Market Concepts, Microsoft Excel Specialist, TOEFL iBT",
                  },
                  {
                    label: "Languages:",
                    value:
                      "Portuguese (Native), English (Fluent), Spanish (Fluent), French (Beginner)",
                  },
                ],
              },
            ],
          };

          let cv = JSON.parse(JSON.stringify(DEFAULT_CV));
          let zoomLevel = 65;
          let debounceTimer = null;
          let resizeTimer = null;

          // â•â•â• PROFILE / TAG SYSTEM â•â•â•
          const PROFILES_KEY = "cv-profiles";
          const ACTIVE_KEY = "cv-active-profile";
          let activeProfile = null;

          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          // INIT
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          function init() {
            loadProfileList();
            const activeName = localStorage.getItem(ACTIVE_KEY);
            if (activeName) {
              loadProfile(activeName, true);
            } else {
              const saved = localStorage.getItem("cv-editor-data");
              if (saved) {
                try { cv = JSON.parse(saved); } catch (e) { cv = JSON.parse(JSON.stringify(DEFAULT_CV)); }
              }
            }
            renderEditor();
            renderPreview();
            autoZoom();
            window.addEventListener('resize', () => {
              clearTimeout(resizeTimer);
              resizeTimer = setTimeout(autoZoom, 200);
            });
          }

          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          // EDITOR RENDERING
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          function renderEditor() {
            const editor = document.getElementById("editor");
            let html = "";

            // Name & Contact
            html += `
        <div class="section-block">
          <div class="section-header" onclick="toggleSection(this)">
            <span class="chevron open">â–¶</span>
            <span class="section-title">Header</span>
          </div>
          <div class="section-body">
            <div class="field-row">
              <span class="field-label">Name</span>
              <input class="field-input" value="${esc(cv.name)}" oninput="cv.name=this.value;schedulePreview()">
            </div>
            <div class="field-row">
              <span class="field-label">Contact</span>
              <input class="field-input" value="${esc(cv.contact)}" oninput="cv.contact=this.value;schedulePreview()">
            </div>
          </div>
        </div>
      `;

            // Sections
            cv.sections.forEach((sec, si) => {
              const secHidden = sec.hidden ? 'item-hidden' : '';
              html += `<div class="section-block ${secHidden}" draggable="true" ondragstart="dragSection(event,${si})" ondragover="dragOverSection(event,${si})" ondrop="dropSection(event,${si})" ondragend="dragEnd(event)">`;
              html += `
          <div class="section-header" onclick="toggleSection(this)">
            <span class="chevron open">â–¶</span>
            <span class="section-title">${esc(sec.title)}</span>
            <div class="section-actions" onclick="event.stopPropagation()">
              <button class="icon-btn eye ${sec.hidden?'hidden-item':''}" onclick="toggleHide('section',${si})" title="${sec.hidden?'Show':'Hide'} section">${sec.hidden?'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>':'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>'}</button>
              <button class="icon-btn" onclick="moveSectionUp(${si})" title="Move up">â†‘</button>
              <button class="icon-btn" onclick="moveSectionDown(${si})" title="Move down">â†“</button>
              <button class="icon-btn delete" onclick="removeSection(${si})" title="Remove section">âœ•</button>
            </div>
          </div>
          <div class="section-body">
            <div class="field-row" style="margin-bottom:6px">
              <span class="field-label">Title</span>
              <input class="field-input" value="${esc(sec.title)}" oninput="cv.sections[${si}].title=this.value;schedulePreview();updateSectionTitle(this,${si})">
            </div>
        `;

              if (sec.type === "summary") {
                html += `<textarea class="field-input" rows="3" oninput="cv.sections[${si}].content=this.value;schedulePreview()">${esc(sec.content)}</textarea>`;
              } else if (sec.type === "jobs") {
                sec.jobs.forEach((job, ji) => {
                  const jobHidden = job.hidden ? 'item-hidden' : '';
                  html += `<div class="job-block ${jobHidden}" draggable="true" ondragstart="dragJob(event,${si},${ji})" ondragover="dragOverJob(event,${si},${ji})" ondrop="dropJob(event,${si},${ji})" ondragend="dragEnd(event)">`;
                  html += `
              <div class="job-header">
                <input class="company" value="${esc(job.company)}" oninput="cv.sections[${si}].jobs[${ji}].company=this.value;schedulePreview()" placeholder="Company | Location">
                <button class="icon-btn eye ${job.hidden?'hidden-item':''}" onclick="toggleHide('job',${si},${ji})" title="${job.hidden?'Show':'Hide'} job">${job.hidden?'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>':'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>'}</button>
                <button class="icon-btn" onclick="moveJobUp(${si},${ji})">â†‘</button>
                <button class="icon-btn" onclick="moveJobDown(${si},${ji})">â†“</button>
                <button class="icon-btn delete" onclick="removeJob(${si},${ji})">âœ•</button>
              </div>
              <div class="job-header">
                <input class="role" value="${esc(job.role)}" oninput="cv.sections[${si}].jobs[${ji}].role=this.value;schedulePreview()" placeholder="Role | Dates">
              </div>
              <ul class="bullet-list">
            `;
                  job.bullets.forEach((b, bi) => {
                    const bHidden = (job.hiddenBullets||[]).includes(bi);
                    html += `
                <li class="bullet-item ${bHidden?'item-hidden':''}" draggable="true" ondragstart="dragBullet(event,${si},${ji},${bi})" ondragover="dragOverBullet(event,${si},${ji},${bi})" ondrop="dropBullet(event,${si},${ji},${bi})" ondragend="dragEnd(event)">
                  <span class="bullet-drag" title="Drag to reorder">â ¿</span>
                  <textarea class="bullet-text" rows="1" oninput="autoGrow(this);cv.sections[${si}].jobs[${ji}].bullets[${bi}]=this.value;schedulePreview()">${esc(b)}</textarea>
                  <div class="bullet-actions">
                    <button class="icon-btn eye ${bHidden?'hidden-item':''}" onclick="toggleHide('bullet',${si},${ji},${bi})" title="${bHidden?'Show':'Hide'}">${bHidden?'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>':'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>'}</button>
                    <button class="icon-btn" onclick="moveBulletUp(${si},${ji},${bi})">â†‘</button>
                    <button class="icon-btn" onclick="moveBulletDown(${si},${ji},${bi})">â†“</button>
                    <button class="icon-btn delete" onclick="removeBullet(${si},${ji},${bi})">âœ•</button>
                  </div>
                </li>
              `;
                  });
                  html += `</ul>`;
                  html += `<div class="add-row"><button class="add-btn" onclick="addBullet(${si},${ji})">+ Add bullet</button></div>`;
                  html += `</div>`;
                });
                html += `<div class="add-row"><button class="add-btn" onclick="addJob(${si})">+ Add job</button></div>`;
              } else if (sec.type === "education") {
                sec.schools.forEach((sch, ei) => {
                  const schHidden = sch.hidden ? 'item-hidden' : '';
                  html += `<div class="job-block ${schHidden}">`;
                  html += `
              <div class="job-header">
                <input class="company" value="${esc(sch.institution)}" oninput="cv.sections[${si}].schools[${ei}].institution=this.value;schedulePreview()">
                <button class="icon-btn eye ${sch.hidden?'hidden-item':''}" onclick="toggleHide('school',${si},${ei})" title="${sch.hidden?'Show':'Hide'}">${sch.hidden?'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>':'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>'}</button>
                <button class="icon-btn" onclick="moveSchoolUp(${si},${ei})">â†‘</button>
                <button class="icon-btn" onclick="moveSchoolDown(${si},${ei})">â†“</button>
                <button class="icon-btn delete" onclick="removeSchool(${si},${ei})">âœ•</button>
              </div>
              <div class="job-header">
                <input class="role" value="${esc(sch.degree)}" oninput="cv.sections[${si}].schools[${ei}].degree=this.value;schedulePreview()">
              </div>
              <ul class="bullet-list">
            `;
                  (sch.details || []).forEach((d, di) => {
                    const dHidden = (sch.hiddenDetails||[]).includes(di);
                    html += `
                <li class="bullet-item ${dHidden?'item-hidden':''}">
                  <span class="bullet-drag">â ¿</span>
                  <textarea class="bullet-text" rows="1" oninput="autoGrow(this);cv.sections[${si}].schools[${ei}].details[${di}]=this.value;schedulePreview()">${esc(d)}</textarea>
                  <div class="bullet-actions">
                    <button class="icon-btn eye ${dHidden?'hidden-item':''}" onclick="toggleHide('eduDetail',${si},${ei},${di})" title="${dHidden?'Show':'Hide'}">${dHidden?'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>':'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>'}</button>
                    <button class="icon-btn delete" onclick="removeEduDetail(${si},${ei},${di})">âœ•</button>
                  </div>
                </li>
              `;
                  });
                  html += `</ul>`;
                  html += `<div class="add-row"><button class="add-btn" onclick="addEduDetail(${si},${ei})">+ Add detail</button></div>`;
                  html += `</div>`;
                });
                html += `<div class="add-row"><button class="add-btn" onclick="addSchool(${si})">+ Add school</button></div>`;
              } else if (sec.type === "leadership") {
                sec.items.forEach((item, li) => {
                  const liHidden = item.hidden ? 'item-hidden' : '';
                  html += `
              <div class="leadership-item ${liHidden}">
                <input class="name" value="${esc(item.name)}" oninput="cv.sections[${si}].items[${li}].name=this.value;schedulePreview()">
                <input class="desc" value="${esc(item.desc)}" oninput="cv.sections[${si}].items[${li}].desc=this.value;schedulePreview()">
                <button class="icon-btn eye ${item.hidden?'hidden-item':''}" onclick="toggleHide('leadership',${si},${li})" title="${item.hidden?'Show':'Hide'}">${item.hidden?'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>':'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>'}</button>
                <button class="icon-btn" onclick="moveLeadershipUp(${si},${li})">â†‘</button>
                <button class="icon-btn" onclick="moveLeadershipDown(${si},${li})">â†“</button>
                <button class="icon-btn delete" onclick="removeLeadership(${si},${li})">âœ•</button>
              </div>
            `;
                });
                html += `<div class="add-row"><button class="add-btn" onclick="addLeadership(${si})">+ Add activity</button></div>`;
              } else if (sec.type === "skills") {
                sec.skills.forEach((sk, ki) => {
                  const skHidden = sk.hidden ? 'item-hidden' : '';
                  html += `
              <div class="skill-row ${skHidden}">
                <input class="skill-label" value="${esc(sk.label)}" oninput="cv.sections[${si}].skills[${ki}].label=this.value;schedulePreview()">
                <input class="skill-value" value="${esc(sk.value)}" oninput="cv.sections[${si}].skills[${ki}].value=this.value;schedulePreview()">
                <button class="icon-btn eye ${sk.hidden?'hidden-item':''}" onclick="toggleHide('skill',${si},${ki})" title="${sk.hidden?'Show':'Hide'}">${sk.hidden?'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>':'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>'}</button>
                <button class="icon-btn delete" onclick="removeSkill(${si},${ki})">âœ•</button>
              </div>
            `;
                });
                html += `<div class="add-row"><button class="add-btn" onclick="addSkill(${si})">+ Add skill</button></div>`;
              }

              html += `</div></div>`;
            });

            editor.innerHTML = html;

            // Auto-grow textareas
            document.querySelectorAll(".bullet-text").forEach((ta) => autoGrow(ta));
          }

          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          // PREVIEW RENDERING + AUTO-FIT
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          function renderPreview() {
            const paper = document.getElementById('paper');
            let html = `<div class="cv-name">${esc(cv.name)}</div>`;
            html += `<div class="cv-contact">${esc(cv.contact)}</div>`;

            cv.sections.forEach(sec => {
              if (sec.hidden) return;
              html += `<div class="cv-section-title">${esc(sec.title)}</div>`;

              if (sec.type === "summary") {
                html += `<div class="cv-summary">${esc(sec.content)}</div>`;
              } else if (sec.type === "jobs") {
                sec.jobs.forEach((job) => {
                  if (job.hidden) return;
                  html += `<div class="cv-company">${esc(job.company)}</div>`;
                  html += `<div class="cv-role">${esc(job.role)}</div>`;
                  job.bullets.forEach((b, bi) => {
                    if ((job.hiddenBullets||[]).includes(bi)) return;
                    html += `<div class="cv-bullet">${esc(b)}</div>`;
                  });
                });
              } else if (sec.type === "education") {
                sec.schools.forEach((sch) => {
                  if (sch.hidden) return;
                  html += `<div class="cv-company">${esc(sch.institution)}</div>`;
                  html += `<div class="cv-role">${esc(sch.degree)}</div>`;
                  (sch.details || []).forEach((d, di) => {
                    if ((sch.hiddenDetails||[]).includes(di)) return;
                    html += `<div class="cv-edu-detail">${esc(d)}</div>`;
                  });
                });
              } else if (sec.type === "leadership") {
                sec.items.forEach((item) => {
                  if (item.hidden) return;
                  html += `<div class="cv-leadership"><strong>${esc(item.name)}</strong> â€” ${esc(item.desc)}</div>`;
                });
              } else if (sec.type === "skills") {
                sec.skills.forEach((sk) => {
                  if (sk.hidden) return;
                  html += `<div class="cv-skill"><strong>${esc(sk.label)}</strong> ${esc(sk.value)}</div>`;
                });
              }
            });

            paper.innerHTML = html;
            autoFit();
          }

          function autoFit() {
            const paper = document.getElementById('paper');
            const checkOverflow = () => paper.scrollHeight > paper.clientHeight;
            const getFillRatio = () => paper.scrollHeight / paper.clientHeight;

            // Count total content entries to determine if page should be filled
            const countEntries = () => {
              let count = 0;
              cv.sections.forEach(sec => {
                count++; // section header
                if (sec.type === 'summary') count += 1;
                else if (sec.type === 'jobs') sec.jobs.forEach(j => { count += 2; count += j.bullets.length; });
                else if (sec.type === 'education') sec.schools.forEach(s => { count += 2; count += (s.details||[]).length; });
                else if (sec.type === 'leadership') count += sec.items.length;
                else if (sec.type === 'skills') count += sec.skills.length;
              });
              return count;
            };

            // â”€â”€ BASE VALUES (your current CV benchmark) â”€â”€
            const BASE = {
              sectionGap: 5, companyGap: 3, bulletGap: 0.5,
              lineHeight: 1.35, nameSize: 15, contactSize: 7.5,
              contactMargin: 6, sectionTitleSize: 9.5, companySize: 8.5,
              roleSize: 8, bodySize: 7.5, padV: 10, padH: 14
            };

            const applyState = (state) => {
              paper.style.padding = `${state.padV}mm ${state.padH}mm`;
              paper.querySelectorAll('.cv-name').forEach(el => el.style.fontSize = state.nameSize + 'pt');
              paper.querySelectorAll('.cv-contact').forEach(el => {
                el.style.fontSize = state.contactSize + 'pt';
                el.style.marginBottom = state.contactMargin + 'px';
              });
              paper.querySelectorAll('.cv-section-title').forEach(el => {
                el.style.fontSize = state.sectionTitleSize + 'pt';
                el.style.marginTop = state.sectionGap + 'px';
              });
              paper.querySelectorAll('.cv-company').forEach(el => {
                el.style.fontSize = state.companySize + 'pt';
                el.style.marginTop = state.companyGap + 'px';
              });
              paper.querySelectorAll('.cv-role').forEach(el => {
                el.style.fontSize = state.roleSize + 'pt';
              });
              paper.querySelectorAll('.cv-bullet, .cv-edu-detail, .cv-leadership, .cv-skill, .cv-summary').forEach(el => {
                el.style.fontSize = state.bodySize + 'pt';
                el.style.lineHeight = String(state.lineHeight);
                el.style.marginBottom = state.bulletGap + 'px';
              });
            };

            // â”€â”€ STEP 1: Start from base â”€â”€
            let state = { ...BASE };
            applyState(state);

            const entries = countEntries();
            // "Ridiculously sparse" = less than ~10 entries (e.g. 2 jobs, no education)
            const TOO_SPARSE = entries < 10;

            // â”€â”€ STEP 2: EXPAND if content doesn't fill the page â”€â”€
            if (!checkOverflow() && !TOO_SPARSE) {
              // Expansion levels: gently add whitespace to fill the page
              // Priority: section gaps â†’ company gaps â†’ bullet gaps â†’ contact margin â†’ line-height
              const expansionSteps = [
                // Phase 1: Increase section gaps
                { sectionGap: 6 }, { sectionGap: 7 }, { sectionGap: 8 }, { sectionGap: 9 },
                { sectionGap: 10 }, { sectionGap: 12 }, { sectionGap: 14 },
                // Phase 2: Increase company/job gaps
                { companyGap: 4 }, { companyGap: 5 }, { companyGap: 6 },
                // Phase 3: Increase bullet spacing
                { bulletGap: 1 }, { bulletGap: 1.5 }, { bulletGap: 2 },
                // Phase 4: Increase contact margin (below header)
                { contactMargin: 8 }, { contactMargin: 10 }, { contactMargin: 12 },
                // Phase 5: Open up line-height a touch
                { lineHeight: 1.40 }, { lineHeight: 1.45 },
                // Phase 6: Larger margins for elegance
                { padV: 11, padH: 15 }, { padV: 12, padH: 16 },
              ];

              let expLevel = 0;
              while (!checkOverflow() && expLevel < expansionSteps.length) {
                const prev = { ...state };
                Object.assign(state, expansionSteps[expLevel]);
                applyState(state);
                if (checkOverflow()) {
                  // This step caused overflow â€” revert and stop
                  state = prev;
                  applyState(state);
                  break;
                }
                expLevel++;
              }
            }

            // â”€â”€ STEP 3: COMPRESS if content overflows â”€â”€
            if (checkOverflow()) {
              // Reset to base first
              state = { ...BASE };
              applyState(state);

              // Compression levels: progressively sacrifice beauty for fit
              const compressionSteps = [
                // Phase 1: Trim section gaps (barely noticeable)
                { sectionGap: 4.5 }, { sectionGap: 4 }, { sectionGap: 3.5 }, { sectionGap: 3 },
                // Phase 2: Tighten company gaps
                { companyGap: 2.5 }, { companyGap: 2 }, { companyGap: 1.5 },
                // Phase 3: Reduce bullet spacing
                { bulletGap: 0.3 }, { bulletGap: 0.1 }, { bulletGap: 0 },
                // Phase 4: Reduce line-height
                { lineHeight: 1.30 }, { lineHeight: 1.25 }, { lineHeight: 1.20 },
                // Phase 5: Contact margin tighter
                { contactMargin: 4 }, { contactMargin: 3 },
                // Phase 6: Reduce body font size
                { bodySize: 7.2 }, { bodySize: 7.0 }, { bodySize: 6.8 },
                // Phase 7: Reduce title fonts
                { sectionTitleSize: 9.0, companySize: 8.0, roleSize: 7.5 },
                { sectionTitleSize: 8.5, companySize: 7.5, roleSize: 7.0 },
                // Phase 8: Reduce name/header
                { nameSize: 14, contactSize: 7 },
                { nameSize: 13, contactSize: 6.5 },
                // Phase 9: Last resort â€” reduce page margins
                { padV: 9, padH: 13 },
                { padV: 8, padH: 12 },
                { padV: 7, padH: 10 },
                { padV: 6, padH: 9 },
              ];

              let compLevel = 0;
              while (checkOverflow() && compLevel < compressionSteps.length) {
                Object.assign(state, compressionSteps[compLevel]);
                applyState(state);
                compLevel++;
              }
            }

            // â”€â”€ STATUS BAR â”€â”€
            const fitStatus = document.getElementById('fit-status');
            const scaleInfo = document.getElementById('scale-info');
            const overflowLine = document.getElementById('overflow-line');
            const ratio = getFillRatio();
            const fillPct = Math.round(ratio * 100);

            if (checkOverflow()) {
              fitStatus.textContent = 'âœ• Overflows â€” reduce content';
              fitStatus.className = 'fit-indicator fit-over';
              overflowLine.style.display = 'block';
            } else if (TOO_SPARSE) {
              fitStatus.textContent = 'â—‹ Sparse content â€” add more to fill page';
              fitStatus.className = 'fit-indicator fit-warn';
              overflowLine.style.display = 'none';
            } else if (fillPct >= 92) {
              fitStatus.textContent = 'âœ“ Perfectly filled';
              fitStatus.className = 'fit-indicator fit-ok';
              overflowLine.style.display = 'none';
            } else if (fillPct >= 80) {
              fitStatus.textContent = 'âœ“ Well balanced';
              fitStatus.className = 'fit-indicator fit-ok';
              overflowLine.style.display = 'none';
            } else {
              fitStatus.textContent = 'âœ“ Fits comfortably';
              fitStatus.className = 'fit-indicator fit-ok';
              overflowLine.style.display = 'none';
            }

            // Show meaningful density info
            const bodyFont = state.bodySize;
            const lh = state.lineHeight;
            scaleInfo.textContent = `Fill: ${fillPct}% | Body: ${bodyFont}pt | LH: ${lh} | Gaps: ${state.sectionGap}px`;
          }

          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          // SECTION OPERATIONS
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          function moveSectionUp(i) {
            if (i <= 0) return;
            [cv.sections[i - 1], cv.sections[i]] = [
              cv.sections[i],
              cv.sections[i - 1],
            ];
            renderEditor();
            renderPreview();
          }
          function moveSectionDown(i) {
            if (i >= cv.sections.length - 1) return;
            [cv.sections[i], cv.sections[i + 1]] = [
              cv.sections[i + 1],
              cv.sections[i],
            ];
            renderEditor();
            renderPreview();
          }
          function removeSection(i) {
            if (!confirm(`Remove section "${cv.sections[i].title}"?`)) return;
            cv.sections.splice(i, 1);
            renderEditor();
            renderPreview();
          }
          function addSection() {
            const type = prompt(
              "Section type: summary, jobs, education, leadership, or skills",
              "jobs",
            );
            if (!type) return;
            const title = prompt("Section title:", "NEW SECTION");
            if (!title) return;
            const sec = { id: "sec_" + Date.now(), type, title };
            if (type === "summary") sec.content = "";
            else if (type === "jobs") sec.jobs = [];
            else if (type === "education") sec.schools = [];
            else if (type === "leadership") sec.items = [];
            else if (type === "skills") sec.skills = [];
            cv.sections.push(sec);
            renderEditor();
            renderPreview();
          }
          function updateSectionTitle(input, si) {
            // Update the header display
            const block = input.closest(".section-block");
            const titleSpan = block.querySelector(".section-title");
            titleSpan.textContent = input.value;
          }

          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          // JOB OPERATIONS
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          function addJob(si) {
            cv.sections[si].jobs.push({ company: "", role: "", bullets: [""] });
            renderEditor();
            renderPreview();
          }
          function removeJob(si, ji) {
            if (!confirm("Remove this job?")) return;
            cv.sections[si].jobs.splice(ji, 1);
            renderEditor();
            renderPreview();
          }
          function moveJobUp(si, ji) {
            if (ji <= 0) return;
            const jobs = cv.sections[si].jobs;
            [jobs[ji - 1], jobs[ji]] = [jobs[ji], jobs[ji - 1]];
            renderEditor();
            renderPreview();
          }
          function moveJobDown(si, ji) {
            const jobs = cv.sections[si].jobs;
            if (ji >= jobs.length - 1) return;
            [jobs[ji], jobs[ji + 1]] = [jobs[ji + 1], jobs[ji]];
            renderEditor();
            renderPreview();
          }

          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          // BULLET OPERATIONS
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          function addBullet(si, ji) {
            cv.sections[si].jobs[ji].bullets.push("");
            renderEditor();
            renderPreview();
          }
          function removeBullet(si, ji, bi) {
            cv.sections[si].jobs[ji].bullets.splice(bi, 1);
            renderEditor();
            renderPreview();
          }
          function moveBulletUp(si, ji, bi) {
            if (bi <= 0) return;
            const bullets = cv.sections[si].jobs[ji].bullets;
            [bullets[bi - 1], bullets[bi]] = [bullets[bi], bullets[bi - 1]];
            renderEditor();
            renderPreview();
          }
          function moveBulletDown(si, ji, bi) {
            const bullets = cv.sections[si].jobs[ji].bullets;
            if (bi >= bullets.length - 1) return;
            [bullets[bi], bullets[bi + 1]] = [bullets[bi + 1], bullets[bi]];
            renderEditor();
            renderPreview();
          }

          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          // EDUCATION OPERATIONS
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          function addSchool(si) {
            cv.sections[si].schools.push({
              institution: "",
              degree: "",
              details: [],
            });
            renderEditor();
            renderPreview();
          }
          function removeSchool(si, ei) {
            if (!confirm("Remove this school?")) return;
            cv.sections[si].schools.splice(ei, 1);
            renderEditor();
            renderPreview();
          }
          function moveSchoolUp(si, ei) {
            if (ei <= 0) return;
            const schools = cv.sections[si].schools;
            [schools[ei - 1], schools[ei]] = [schools[ei], schools[ei - 1]];
            renderEditor();
            renderPreview();
          }
          function moveSchoolDown(si, ei) {
            const schools = cv.sections[si].schools;
            if (ei >= schools.length - 1) return;
            [schools[ei], schools[ei + 1]] = [schools[ei + 1], schools[ei]];
            renderEditor();
            renderPreview();
          }
          function addEduDetail(si, ei) {
            cv.sections[si].schools[ei].details.push("");
            renderEditor();
            renderPreview();
          }
          function removeEduDetail(si, ei, di) {
            cv.sections[si].schools[ei].details.splice(di, 1);
            renderEditor();
            renderPreview();
          }

          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          // LEADERSHIP OPERATIONS
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          function addLeadership(si) {
            cv.sections[si].items.push({ name: "", desc: "" });
            renderEditor();
            renderPreview();
          }
          function removeLeadership(si, li) {
            cv.sections[si].items.splice(li, 1);
            renderEditor();
            renderPreview();
          }
          function moveLeadershipUp(si, li) {
            if (li <= 0) return;
            const items = cv.sections[si].items;
            [items[li - 1], items[li]] = [items[li], items[li - 1]];
            renderEditor();
            renderPreview();
          }
          function moveLeadershipDown(si, li) {
            const items = cv.sections[si].items;
            if (li >= items.length - 1) return;
            [items[li], items[li + 1]] = [items[li + 1], items[li]];
            renderEditor();
            renderPreview();
          }


          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          // HIDE/SHOW TOGGLE
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          function toggleHide(type, si, ji, bi) {
            switch (type) {
              case 'section':
                cv.sections[si].hidden = !cv.sections[si].hidden;
                break;
              case 'job':
                cv.sections[si].jobs[ji].hidden = !cv.sections[si].jobs[ji].hidden;
                break;
              case 'bullet': {
                const job = cv.sections[si].jobs[ji];
                if (!job.hiddenBullets) job.hiddenBullets = [];
                const idx = job.hiddenBullets.indexOf(bi);
                if (idx === -1) job.hiddenBullets.push(bi);
                else job.hiddenBullets.splice(idx, 1);
                break;
              }
              case 'school':
                cv.sections[si].schools[ji].hidden = !cv.sections[si].schools[ji].hidden;
                break;
              case 'eduDetail': {
                const sch = cv.sections[si].schools[ji];
                if (!sch.hiddenDetails) sch.hiddenDetails = [];
                const idx = sch.hiddenDetails.indexOf(bi);
                if (idx === -1) sch.hiddenDetails.push(bi);
                else sch.hiddenDetails.splice(idx, 1);
                break;
              }
              case 'leadership':
                cv.sections[si].items[ji].hidden = !cv.sections[si].items[ji].hidden;
                break;
              case 'skill':
                cv.sections[si].skills[ji].hidden = !cv.sections[si].skills[ji].hidden;
                break;
            }
            renderEditor();
            renderPreview();
          }
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          // SKILLS OPERATIONS
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          function addSkill(si) {
            cv.sections[si].skills.push({ label: "", value: "" });
            renderEditor();
            renderPreview();
          }
          function removeSkill(si, ki) {
            cv.sections[si].skills.splice(ki, 1);
            renderEditor();
            renderPreview();
          }

          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          // DRAG AND DROP â€” SECTIONS
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          let dragType = null,
            dragFrom = null;

          function dragSection(e, i) {
            dragType = "section";
            dragFrom = { si: i };
            e.dataTransfer.effectAllowed = "move";
            e.target.classList.add("dragging");
          }
          function dragOverSection(e, i) {
            if (dragType !== "section") return;
            e.preventDefault();
            e.dataTransfer.dropEffect = "move";
          }
          function dropSection(e, i) {
            if (dragType !== "section") return;
            e.preventDefault();
            const from = dragFrom.si;
            if (from === i) return;
            const item = cv.sections.splice(from, 1)[0];
            cv.sections.splice(i, 0, item);
            renderEditor();
            renderPreview();
          }

          // DRAG â€” JOBS
          function dragJob(e, si, ji) {
            dragType = "job";
            dragFrom = { si, ji };
            e.dataTransfer.effectAllowed = "move";
            e.stopPropagation();
            e.target.classList.add("dragging");
          }
          function dragOverJob(e, si, ji) {
            if (dragType !== "job" || dragFrom.si !== si) return;
            e.preventDefault();
            e.stopPropagation();
          }
          function dropJob(e, si, ji) {
            if (dragType !== "job" || dragFrom.si !== si) return;
            e.preventDefault();
            e.stopPropagation();
            const from = dragFrom.ji;
            if (from === ji) return;
            const jobs = cv.sections[si].jobs;
            const item = jobs.splice(from, 1)[0];
            jobs.splice(ji, 0, item);
            renderEditor();
            renderPreview();
          }

          // DRAG â€” BULLETS
          function dragBullet(e, si, ji, bi) {
            dragType = "bullet";
            dragFrom = { si, ji, bi };
            e.dataTransfer.effectAllowed = "move";
            e.stopPropagation();
            e.target.classList.add("dragging");
          }
          function dragOverBullet(e, si, ji, bi) {
            if (dragType !== "bullet" || dragFrom.si !== si || dragFrom.ji !== ji)
              return;
            e.preventDefault();
            e.stopPropagation();
          }
          function dropBullet(e, si, ji, bi) {
            if (dragType !== "bullet" || dragFrom.si !== si || dragFrom.ji !== ji)
              return;
            e.preventDefault();
            e.stopPropagation();
            const from = dragFrom.bi;
            if (from === bi) return;
            const bullets = cv.sections[si].jobs[ji].bullets;
            const item = bullets.splice(from, 1)[0];
            bullets.splice(bi, 0, item);
            renderEditor();
            renderPreview();
          }

          function dragEnd(e) {
            dragType = null;
            dragFrom = null;
            document
              .querySelectorAll(".dragging")
              .forEach((el) => el.classList.remove("dragging"));
          }

          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          // UTILITIES
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          function esc(s) {
            if (!s) return "";
            return s
              .replace(/&/g, "&amp;")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;")
              .replace(/"/g, "&quot;");
          }

          function autoGrow(el) {
            el.style.height = "auto";
            el.style.height = el.scrollHeight + "px";
          }

          function toggleSection(header) {
            const body = header.nextElementSibling;
            const chevron = header.querySelector(".chevron");
            body.classList.toggle("collapsed");
            chevron.classList.toggle("open");
          }

          function setZoom(val) {
            zoomLevel = parseInt(val);
            document.getElementById("zoom-val").textContent = zoomLevel + "%";
            document.querySelector(".zoom-slider").value = zoomLevel;
            document.querySelector(".paper").style.transform = `scale(${zoomLevel / 100})`;
          }

          function autoZoom() {
            const panel = document.querySelector('.preview-panel');
            const toolbar = document.querySelector('.preview-toolbar');
            const paperW = 793.7; // 210mm in px
            const paperH = 1122.5; // 297mm in px
            const availW = panel.clientWidth - 40;
            const availH = panel.clientHeight - (toolbar ? toolbar.offsetHeight : 0) - 40;
            const scaleW = availW / paperW;
            const scaleH = availH / paperH;
            const scale = Math.min(scaleW, scaleH);
            const zoom = Math.max(20, Math.min(200, Math.round(scale * 100)));
            setZoom(zoom);
          }

          function schedulePreview() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
              renderPreview();
              // Auto-save to current profile quietly
              if (activeProfile) {
                const profiles = getProfiles();
                profiles[activeProfile] = JSON.parse(JSON.stringify(cv));
                setProfiles(profiles);
              }
              localStorage.setItem("cv-editor-data", JSON.stringify(cv));
            }, 150);
          }

          function saveToStorage() {
            // Legacy: also saves to old key for backward compat
            localStorage.setItem("cv-editor-data", JSON.stringify(cv));
            if (activeProfile) {
              saveCurrentProfile(true);
            } else {
              alert("Saved! Use 'Save As' to save with a tag.");
            }
          }

          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          // PROFILE / TAG MANAGEMENT
          // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          function getProfiles() {
            try { return JSON.parse(localStorage.getItem(PROFILES_KEY) || "{}"); } catch(e) { return {}; }
          }

          function setProfiles(profiles) {
            localStorage.setItem(PROFILES_KEY, JSON.stringify(profiles));
          }

          function loadProfileList() {
            const sel = document.getElementById('profile-select');
            const profiles = getProfiles();
            const names = Object.keys(profiles).sort();
            sel.innerHTML = '<option value="">â€” Unsaved Draft â€”</option>';
            names.forEach(name => {
              const opt = document.createElement('option');
              opt.value = name;
              opt.textContent = name;
              if (name === activeProfile) opt.selected = true;
              sel.appendChild(opt);
            });
            updateProfileIndicator();
          }

          function updateProfileIndicator() {
            const ind = document.getElementById('profile-indicator');
            if (ind) ind.textContent = activeProfile ? 'ğŸ· ' + activeProfile : '';
          }

          function loadProfile(name, silent) {
            if (!name) {
              // Switching to "unsaved draft" â€” load from legacy storage or default
              activeProfile = null;
              localStorage.removeItem(ACTIVE_KEY);
              const saved = localStorage.getItem('cv-editor-data');
              if (saved) { try { cv = JSON.parse(saved); } catch(e) { cv = JSON.parse(JSON.stringify(DEFAULT_CV)); } }
              else { cv = JSON.parse(JSON.stringify(DEFAULT_CV)); }
              renderEditor(); renderPreview();
              updateProfileIndicator();
              return;
            }
            const profiles = getProfiles();
            if (profiles[name]) {
              cv = JSON.parse(JSON.stringify(profiles[name]));
              activeProfile = name;
              localStorage.setItem(ACTIVE_KEY, name);
              renderEditor(); renderPreview();
              loadProfileList();
              if (!silent) { showToast('Loaded: ' + name); }
            }
          }

          function saveAsProfile() {
            const suggested = activeProfile || '';
            const name = prompt('Save CV with tag name (e.g. "Google AE", "Sales CV", "Consulting"):', suggested);
            if (!name || !name.trim()) return;
            const tag = name.trim();
            const profiles = getProfiles();
            if (profiles[tag] && !confirm('Overwrite existing profile "' + tag + '"?')) return;
            profiles[tag] = JSON.parse(JSON.stringify(cv));
            setProfiles(profiles);
            activeProfile = tag;
            localStorage.setItem(ACTIVE_KEY, tag);
            localStorage.setItem('cv-editor-data', JSON.stringify(cv));
            loadProfileList();
            showToast('Saved: ' + tag);
          }

          function saveCurrentProfile(quiet) {
            if (!activeProfile) { saveAsProfile(); return; }
            const profiles = getProfiles();
            profiles[activeProfile] = JSON.parse(JSON.stringify(cv));
            setProfiles(profiles);
            localStorage.setItem('cv-editor-data', JSON.stringify(cv));
            if (!quiet) showToast('Saved: ' + activeProfile);
          }

          function deleteProfile() {
            const sel = document.getElementById('profile-select');
            const name = sel.value;
            if (!name) { alert('Select a profile to delete.'); return; }
            if (!confirm('Delete profile "' + name + '"? This cannot be undone.')) return;
            const profiles = getProfiles();
            delete profiles[name];
            setProfiles(profiles);
            if (activeProfile === name) {
              activeProfile = null;
              localStorage.removeItem(ACTIVE_KEY);
            }
            loadProfileList();
            showToast('Deleted: ' + name);
          }

          function showToast(msg) {
            let toast = document.getElementById('cv-toast');
            if (!toast) {
              toast = document.createElement('div');
              toast.id = 'cv-toast';
              toast.style.cssText = 'position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#22c55e;color:#fff;padding:8px 20px;border-radius:8px;font-size:12px;font-weight:600;z-index:9999;opacity:0;transition:opacity 0.3s;pointer-events:none;font-family:inherit;';
              document.body.appendChild(toast);
            }
            toast.textContent = msg;
            toast.style.opacity = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 2000);
          }

          function resetToDefault() {
            if (!confirm("Reset to default CV data? All changes will be lost."))
              return;
            cv = JSON.parse(JSON.stringify(DEFAULT_CV));
            localStorage.removeItem("cv-editor-data");
            renderEditor();
            renderPreview();
          }

          function exportPDF() {
            // Tip: In Chrome/Safari print dialog, set Margins to "None" and uncheck "Headers and footers"
            // This ensures only the CV content appears in the PDF
            const origTitle = document.title;
            document.title = activeProfile ? activeProfile : 'draft';
            window.print();
            document.title = origTitle;
          }

          /* â•â•â• PROFILE EXPORT / IMPORT â•â•â• */
          function exportProfiles() {
            const profiles = getProfiles();
            const keys = Object.keys(profiles);
            if (keys.length === 0) { alert('No saved profiles to export.'); return; }
            const blob = new Blob([JSON.stringify(profiles, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'cv-profiles-backup.json';
            a.click();
            URL.revokeObjectURL(a.href);
            showToast('Exported ' + keys.length + ' profile(s)');
          }

          function importProfiles() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
              const file = e.target.files[0];
              if (!file) return;
              const reader = new FileReader();
              reader.onload = (ev) => {
                try {
                  const imported = JSON.parse(ev.target.result);
                  if (typeof imported !== 'object' || Array.isArray(imported)) throw new Error('Bad format');
                  const existing = getProfiles();
                  let count = 0;
                  for (const [name, data] of Object.entries(imported)) {
                    if (existing[name]) {
                      if (!confirm('Profile "' + name + '" already exists. Overwrite?')) continue;
                    }
                    existing[name] = data;
                    count++;
                  }
                  setProfiles(existing);
                  loadProfileList();
                  showToast('Imported ' + count + ' profile(s)');
                } catch (err) {
                  alert('Invalid file: ' + err.message);
                }
              };
              reader.readAsText(file);
            };
            input.click();
          }

          // Keyboard shortcut: Cmd+S to save current profile
          document.addEventListener("keydown", (e) => {
            if ((e.metaKey || e.ctrlKey) && e.key === "s") {
              e.preventDefault();
              saveCurrentProfile();
            }
          });

          // Start
          init();
    </script>
  </body>
</html>
